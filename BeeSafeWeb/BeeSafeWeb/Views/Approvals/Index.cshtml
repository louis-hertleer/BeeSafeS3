@{
ViewData["Title"] = "Show Pending Devices";
List<Device> devices = Model;
}
<div class="p-4">
    <div>
        <h1 class="text-3xl font-bold text-center">Pending Devices</h1>
        <p class="text-center">
            @if (devices.Count > 0)
            {
                <span>Here you can see the devices that are pending approval. Click "Set Location" view and select the location on the map.</span>
            }
            else
            {
                <span>There are no pending devices at the moment. Please check again later!</span>
            }
        </p>
    </div>

    @if(devices.Count > 0)
    {
    <div class="overflow-x-auto mt-4">
        <table class="min-w-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-sm sm:text-lg">
            <thead class="bg-gray-200 dark:bg-gray-700 text-center">
            <tr>
                <th class="py-3 px-4 border">Name</th>
                <th class="py-3 px-4 border">Latitude</th>
                <th class="py-3 px-4 border">Longitude</th>
                <th class="py-3 px-4 border">Direction</th>
                <th class="py-3 px-4 border">Action</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var device in devices)
            {
                <tr class="text-center border-t">
                    <td class=" px-4">
                        <input id="name-@device.Id"
                               class="border rounded p-2 w-full dark:bg-gray-700 text-lg"
                               value="@device.Name">
                    </td>
                    <td class=" px-4">
                        <input id="latitude-@device.Id"
                               class="border rounded p-2 w-full dark:bg-gray-700 text-lg"
                               value="@device.Latitude">
                    </td>
                    <td class="py-3 px-4">
                        <input id="longitude-@device.Id"
                               class="border rounded p-2 w-full dark:bg-gray-700 text-lg"
                               value="@device.Longitude">
                    </td>
                    <td class="py-3 px-4">
                        <input id="direction-@device.Id"
                               class="border rounded p-2 w-full dark:bg-gray-700 text-lg"
                               value="@device.Direction">
                    </td>
                    <td class="py-3 px-4 text-center">
                        <div class="flex flex-col sm:flex-row gap-2 justify-center items-center">
                            <button class="bg-yellow-500 text-white px-6 py-3 rounded hover:bg-yellow-600 transition duration-200"
                                    onclick="openModal('@device.Id')">
                                Set Location
                            </button>

                            <form id="approval-form-@device.Id" class="hidden flex" method="post" action="@Url.Action("ApproveDevice", "Approvals")">
                                <input type="hidden" name="id" value="@device.Id">
                                <input type="hidden" id="form-name-@device.Id" name="name">
                                <input type="hidden" id="form-latitude-@device.Id" name="latitude">
                                <input type="hidden" id="form-longitude-@device.Id" name="longitude">
                                <input type="hidden" id="form-direction-@device.Id" name="direction">
                                <button type="submit" class="bg-green-500 text-white px-6 py-3 rounded hover:bg-green-600 transition duration-200">
                                    Approve
                                </button>
                            </form>

                            <form method="post" onsubmit="rejectDevice(event)" asp-action="RejectDevice" asp-controller="Approvals">
                                <input type="hidden" name="id" value="@device.Id">
                                <button type="submit" class="bg-red-500 text-white px-6 py-3 rounded hover:bg-red-600 transition duration-200">
                                    Decline
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
    }
</div>

<!-- Location Modal -->
<div id="location-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl shadow-lg relative w-full max-w-lg sm:max-w-2xl">
        <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white text-center">Set Device Location</h2>

        <!-- Search Bar -->
        <div class="mb-4">
            <input type="text" id="city-search" placeholder="Enter city name in Belgium"
                   class="w-full p-4 border rounded-md dark:bg-gray-700 dark:text-white text-lg"
                   onkeypress="handleKeyPress(event)">
            <button onclick="searchCity()" class="mt-2 w-full sm:w-auto bg-yellow-500 text-white px-6 py-3 rounded hover:bg-yellow-600">
                Search
            </button>
        </div>

        <!-- Map Container -->
        <div id="map" class="w-full h-[60vh] sm:h-[50vh] border rounded-md shadow-md"></div>

        <div class="mt-6 flex flex-col sm:flex-row gap-2 justify-between">
            <button onclick="confirmLocation()" class="w-full sm:w-auto bg-yellow-500 text-white px-6 py-3 rounded hover:bg-yellow-600">
                Confirm Location
            </button>
            <button type="button" onclick="closeModal()" class="w-full sm:w-auto bg-red-500 text-white px-6 py-3 rounded hover:bg-red-600">
                Cancel
            </button>
        </div>
    </div>
</div>


@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="~/js/device.js"></script>
}
