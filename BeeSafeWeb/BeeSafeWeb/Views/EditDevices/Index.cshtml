@{
    Layout = "_Layout";

    var devices = Model;
}

<div>
<table class="min-w-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-sm sm:text-lg">
    <thead class="bg-gray-200 dark:bg-gray-700 text-center">
    <tr>
        <th class="py-3 px-4 border">Latitude</th>
        <th class="py-3 px-4 border">Longitude</th>
        <th class="py-3 px-4 border">Direction</th>
        <th class="py-3 px-4 border">Action</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var device in devices)
    {
            <tr class="text-center border-t">
                <td class=" px-4">
                    <input id="latitude-@device.Id"
                           name="Latitude"
                           class="border rounded p-2 w-full dark:bg-gray-700 text-lg"
                           value="@device.Latitude">
                </td>
                <td class="py-3 px-4">
                    <input id="longitude-@device.Id"
                           class="border rounded p-2 w-full dark:bg-gray-700 text-lg"
                           value="@device.Longitude">
                </td>
                <td class="py-3 px-4">
                    <input id="direction-@device.Id"
                           class="border rounded p-2 w-full dark:bg-gray-700 text-lg"
                           value="@device.Direction">
                </td>
                <td class="py-3 px-4 text-center">
                    <div class="flex flex-col sm:flex-row gap-2 justify-center items-center">
                        <button class="bg-yellow-500 text-white px-6 py-3 rounded hover:bg-yellow-600 transition duration-200"
                                type="button"
                                onclick="openModal('@device.Id')">
                            Set Location
                        </button>
                        <form id="approval-form-@device.Id" asp-action="Update" method="post" asp-route-id="@device.Id">
                            <input type="hidden" name="id" value="@device.Id">
                            <input type="hidden" id="form-latitude-@device.Id" name="latitude">
                            <input type="hidden" id="form-longitude-@device.Id" name="longitude">
                            <input type="hidden" id="form-direction-@device.Id" name="direction">
                            <button type="submit" class="bg-green-500 text-white px-6 py-3 rounded hover:bg-green-600 transition duration-200">
                                Save Changes
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
    }
    </tbody>
</table>
</div>

<div id="location-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl shadow-lg relative w-full max-w-lg sm:max-w-2xl">
        <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white text-center">Set Device Location</h2>

        <!-- Search Bar -->
        <div class="mb-4">
            <input type="text" id="city-search" placeholder="Enter city name in Belgium"
                   class="w-full p-4 border rounded-md dark:bg-gray-700 dark:text-white text-lg"
                   onkeypress="handleKeyPress(event)">
            <button onclick="searchCity()" class="mt-2 w-full sm:w-auto bg-yellow-500 text-white px-6 py-3 rounded hover:bg-yellow-600">
                Search
            </button>
        </div>

        <!-- Map Container -->
        <div id="map" class="w-full h-[60vh] sm:h-[50vh] border rounded-md shadow-md"></div>

        <div class="mt-6 flex flex-col sm:flex-row gap-2 justify-between">
            <button onclick="confirmLocation()" class="w-full sm:w-auto bg-yellow-500 text-white px-6 py-3 rounded hover:bg-yellow-600">
                Confirm Location
            </button>
            <button type="button" onclick="closeModal()" class="w-full sm:w-auto bg-red-500 text-white px-6 py-3 rounded hover:bg-red-600">
                Cancel
            </button>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="~/js/device.js"></script>
}
